<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leo | Creative Partner</title>
    <style>
        :root {
            --primary: #8b5cf6;
            --accent: #00f2ff;
            --glass: rgba(15, 23, 42, 0.8);
            --border: rgba(255, 255, 255, 0.1);
            /* This variable will be updated by JavaScript */
            --sprite-path: url('/static/assets/Samurai/Idle.png');
        }

        body {
            margin: 0; padding: 0;
            font-family: 'Inter', system-ui, sans-serif;
            background: #0f172a;
            background-image: linear-gradient(rgba(10, 10, 15, 0.7), rgba(10, 10, 15, 0.7)), 
                              url('https://images.unsplash.com/photo-1519681393784-d120267933ba?q=80&w=2070');
            background-size: cover; background-attachment: fixed;
            color: white; display: flex; height: 100vh; overflow: hidden;
        }

        #app-container { display: flex; width: 100%; height: 100%; backdrop-filter: blur(10px); }

        #memoryPanel {
            width: 350px; background: rgba(0, 0, 0, 0.4);
            border-right: 1px solid var(--border);
            display: flex; flex-direction: column; padding: 40px 25px; overflow-y: auto;
        }

        #main { flex: 1; display: flex; flex-direction: column; padding: 40px; position: relative; }

        #top-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }

        #leo-logo h1 {
            font-size: 2.5rem; margin: 0; font-weight: 800;
            background: linear-gradient(to right, #fff, var(--primary));
            -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent;
        }

        /* --- SPRITE STAGE --- */
        #leo-stage {
            height: 180px; display: flex; flex-direction: column;
            justify-content: center; align-items: center; position: relative;
        }

        #leo-sprite {
            width: 128px; height: 128px;
            background-image: var(--sprite-path);
            background-repeat: no-repeat;
            image-rendering: pixelated;
            z-index: 10;
        }

        /* Sprite Animations based on frame counts [cite: 141, 151] */
        .anim-idle { animation: play6 0.8s steps(6) infinite; }
        .anim-run  { animation: play8 0.8s steps(8) infinite; }

        @keyframes play6 { from { background-position: 0px; } to { background-position: -768px; } }
        @keyframes play8 { from { background-position: 0px; } to { background-position: -1024px; } }

        .shadow {
            width: 60px; height: 10px; background: rgba(0,0,0,0.3);
            border-radius: 50%; filter: blur(4px); margin-top: -10px;
        }

        #chat {
            flex: 1; background: var(--glass); border: 1px solid var(--border);
            border-radius: 20px; padding: 30px; overflow-y: auto;
            display: flex; flex-direction: column; gap: 20px;
        }

        .message { max-width: 70%; padding: 15px 20px; border-radius: 18px; line-height: 1.5; }
        .user { align-self: flex-end; background: var(--primary); }
        .assistant { align-self: flex-start; background: rgba(255,255,255,0.05); border: 1px solid var(--border); }

        #input-area { margin-top: 20px; display: flex; gap: 10px; }
        input { flex: 1; background: var(--glass); border: 1px solid var(--border); padding: 15px; border-radius: 12px; color: white; outline: none; }
        button { background: var(--primary); color: white; border: none; padding: 0 25px; border-radius: 12px; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>

<div id="app-container">
    <div id="memoryPanel">
        <div style="color: var(--accent); font-weight: bold; margin-bottom: 10px;">SAMURAI ACTIVE</div>
        <div id="shortMemory"></div>
    </div>

    <div id="main">
        <div id="top-bar">
            <div id="leo-logo"><h1>Leo</h1><p>CREATIVE CO-PILOT</p></div>
            <div id="leo-stage">
                <div id="leo-sprite" class="anim-idle"></div>
                <div class="shadow"></div>
            </div>
            <div id="clock-widget"><div id="clock" style="font-family: monospace; font-size: 1.5rem; color: var(--accent);">00:00</div></div>
        </div>

        <div id="chat">
            <div class="message assistant"><strong>Leo:</strong> Samurai systems live. What's the mission?</div>
        </div>

        <div id="input-area">
            <input type="text" id="userInput" placeholder="Collaborate with Leo..." autocomplete="off" />
            <button onclick="sendMessage()">SEND</button>
        </div>
    </div>
</div>

<script>
    const sprite = document.getElementById('leo-sprite');

    function setAction(type) {
        // Filenames match your metadata: Idle.png and Run.png [cite: 141, 151, 171, 317, 327]
        const fileName = type === 'run' ? 'Run.png' : 'Idle.png';
        const path = `url('/static/assets/Samurai/${fileName}')`;
        document.documentElement.style.setProperty('--sprite-path', path);
        sprite.className = type === 'run' ? 'anim-run' : 'anim-idle';
    }

    async function sendMessage() {
        const input = document.getElementById("userInput");
        const text = input.value.trim();
        if (!text) return;

        addMessage("Writer", text, "user");
        input.value = "";
        setAction('run');

        try {
            const res = await fetch("/chat", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ text: text })
            });
            const data = await res.json();
            addMessage("Leo", data.response, "assistant");
            setAction('idle');
        } catch (e) {
            setAction('idle');
        }
    }

    function addMessage(s, t, c) {
        const m = document.createElement("div");
        m.className = `message ${c}`;
        m.innerHTML = `<strong>${s}:</strong> ${t}`;
        document.getElementById('chat').appendChild(m);
        document.getElementById('chat').scrollTop = document.getElementById('chat').scrollHeight;
    }

    function updateClock() {
        const now = new Date();
        document.getElementById("clock").textContent = now.getHours().toString().padStart(2, '0') + ":" + now.getMinutes().toString().padStart(2, '0');
    }
    setInterval(updateClock, 1000);
    updateClock();
</script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leo | Creative Partner</title>
    <style>
        :root {
            --primary: #8b5cf6;
            --accent: #00f2ff;
            --glass: rgba(15, 23, 42, 0.8);
            --border: rgba(255, 255, 255, 0.1);
            --bg-img: none; /* Handled by JS */
        }

        body {
            margin: 0; padding: 0;
            font-family: 'Inter', system-ui, sans-serif;
            background: #0f172a;
            background-image: linear-gradient(rgba(10, 10, 15, 0.7), rgba(10, 10, 15, 0.7)), 
                              url('https://images.unsplash.com/photo-1519681393784-d120267933ba?q=80&w=2070');
            background-size: cover; background-attachment: fixed;
            color: white; display: flex; height: 100vh; overflow: hidden;
        }

        #app-container { display: flex; width: 100%; height: 100%; backdrop-filter: blur(10px); }

        /* Sidebar */
        #memoryPanel {
            width: 350px; background: rgba(0, 0, 0, 0.4);
            border-right: 1px solid var(--border);
            display: flex; flex-direction: column; padding: 40px 25px; overflow-y: auto;
        }

        .char-btn {
            background: var(--glass); border: 1px solid var(--border);
            color: white; padding: 10px; margin-bottom: 8px; cursor: pointer;
            font-family: 'monospace'; font-size: 0.8rem; border-radius: 8px;
            transition: 0.3s;
        }
        .char-btn:hover { border-color: var(--accent); background: rgba(139, 92, 246, 0.2); }

        #main { flex: 1; display: flex; flex-direction: column; padding: 40px; position: relative; }

        #top-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }

        #leo-logo h1 {
            font-size: 2.5rem; margin: 0; font-weight: 800;
            background: linear-gradient(to right, #fff, var(--primary));
            -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent;
        }

        /* --- SPRITE STAGE --- */
        #leo-stage {
            height: 180px; display: flex; flex-direction: column;
            justify-content: center; align-items: center; position: relative;
        }

        #leo-sprite {
            width: 128px; height: 128px;
            background-image: var(--bg-img);
            background-repeat: no-repeat;
            image-rendering: pixelated;
            z-index: 10;
        }

        /* Sprite Animations - No red lines here! */
        .anim-idle { animation: play6 0.8s steps(6) infinite; }
        .anim-walk { animation: play8 0.8s steps(8) infinite; }
        .anim-attack { animation: play5 0.5s steps(5) forwards; }
        .anim-jump { animation: play12 1.2s steps(12) infinite; }

        @keyframes play6 { from { background-position: 0px; } to { background-position: -768px; } }
        @keyframes play8 { from { background-position: 0px; } to { background-position: -1024px; } }
        @keyframes play5 { from { background-position: 0px; } to { background-position: -640px; } }
        @keyframes play12 { from { background-position: 0px; } to { background-position: -1536px; } }

        #chat {
            flex: 1; background: var(--glass); border: 1px solid var(--border);
            border-radius: 20px; padding: 30px; overflow-y: auto;
            display: flex; flex-direction: column; gap: 20px;
        }

        .message { max-width: 70%; padding: 15px 20px; border-radius: 18px; line-height: 1.5; }
        .user { align-self: flex-end; background: var(--primary); }
        .assistant { align-self: flex-start; background: rgba(255,255,255,0.05); border: 1px solid var(--border); }

        #input-area { margin-top: 20px; display: flex; gap: 10px; }
        input { flex: 1; background: var(--glass); border: 1px solid var(--border); padding: 15px; border-radius: 12px; color: white; outline: none; }
        button#send-btn { background: var(--primary); color: white; border: none; padding: 0 25px; border-radius: 12px; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>

<div id="app-container">
    <div id="memoryPanel">
        <div style="color: var(--accent); font-weight: bold; margin-bottom: 15px; letter-spacing: 1px;">SWITCH ENTITY</div>
        <button class="char-btn" onclick="switchChar('Shinobi')">SHINOBI</button>
        <button class="char-btn" onclick="switchChar('Fighter')">FIGHTER</button>
        <button class="char-btn" onclick="switchChar('Samurai')">SAMURAI</button>
        
        <div style="margin-top: 30px; color: var(--accent); font-weight: bold;">HISTORY</div>
        <div id="shortMemory"></div>
    </div>

    <div id="main">
        <div id="top-bar">
            <div id="leo-logo"><h1>Leo</h1><p>CREATIVE CO-PILOT</p></div>
            
            <div id="leo-stage">
                <div id="leo-sprite" class="anim-idle"></div>
                <div style="width: 60px; height: 10px; background: rgba(0,0,0,0.3); border-radius: 50%; filter: blur(4px); margin-top: -10px;"></div>
            </div>

            <div id="clock-widget">
                <div id="clock" style="font-family: monospace; font-size: 1.5rem; color: var(--accent);">00:00</div>
                <div id="date" style="font-size: 0.7rem; color: #94a3b8;">FEB 2026</div>
            </div>
        </div>

        <div id="chat">
            <div class="message assistant"><strong>Leo:</strong> Sprite systems online. Which entity shall we use today?</div>
        </div>

        <div id="input-area">
            <input type="text" id="userInput" placeholder="Collaborate with Leo..." autocomplete="off" />
            <button id="send-btn" onclick="sendMessage()">SEND</button>
        </div>
    </div>
</div>

<script>
    const sprite = document.getElementById('leo-sprite');
    let currentFolder = 'Shinobi'; // Default character folder [cite: 172]

    // This function builds the URL correctly to avoid CSS syntax errors
    function updateSpriteImage(fileName) {
        const path = `url('/static/assets/${currentFolder}/${fileName}.png')`;
        sprite.style.setProperty('--bg-img', path);
    }

    function switchChar(name) {
        currentFolder = name;
        updateSpriteImage('Idle'); // Switches to the specific Idle.png [cite: 141]
        sprite.className = 'anim-idle';
    }

    async function sendMessage() {
        const input = document.getElementById("userInput");
        const text = input.value.trim();
        if (!text) return;

        addMessage("Writer", text, "user");
        input.value = "";
        
        // Use Walk.png (8 frames) while processing [cite: 314]
        updateSpriteImage('Walk');
        sprite.className = 'anim-walk';

        try {
            const res = await fetch("/chat", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ text: text })
            });
            const data = await res.json();
            
            // Use Attack_1.png (5 frames) on response [cite: 138]
            updateSpriteImage('Attack_1');
            sprite.className = 'anim-attack';
            
            setTimeout(() => {
                updateSpriteImage('Idle');
                sprite.className = 'anim-idle';
            }, 600);
            
            addMessage("Leo", data.response, "assistant");
        } catch (e) {
            updateSpriteImage('Idle');
            sprite.className = 'anim-idle';
        }
    }

    function addMessage(s, t, c) {
        const m = document.createElement("div");
        m.className = `message ${c}`;
        m.innerHTML = `<strong>${s}:</strong> ${t}`;
        document.getElementById('chat').appendChild(m);
        document.getElementById('chat').scrollTop = document.getElementById('chat').scrollHeight;
    }

    function updateClock() {
        const now = new Date();
        document.getElementById("clock").textContent = now.getHours().toString().padStart(2, '0') + ":" + now.getMinutes().toString().padStart(2, '0');
    }

    // Initialize the default character
    updateSpriteImage('Idle');
    setInterval(updateClock, 1000);
    updateClock();
</script>
</body>
</html>